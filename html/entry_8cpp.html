<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>/home/user/hypervisor/bfvmm/src/entry/src/entry.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_4ad2d4d86f59ad5437031c40d2e6ddb2.html">bfvmm</a></li><li class="navelem"><a class="el" href="dir_eb38dbf1b07aea4a1e5e1050250153ab.html">src</a></li><li class="navelem"><a class="el" href="dir_3ea6cbee148a6a2446881afd839b6741.html">entry</a></li><li class="navelem"><a class="el" href="dir_2cf2ba16f4f7211b6a7194a550ecc6aa.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">entry.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><a href="entry_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a7db5bff8a5a82a868ae1b3117ede682a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="entry_8cpp.html#a7db5bff8a5a82a868ae1b3117ede682a">guard</a>(a)</td></tr>
<tr class="separator:a7db5bff8a5a82a868ae1b3117ede682a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa40eb71eaae48a5fe3cf91258ee53653"><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr class="memitem:aa40eb71eaae48a5fe3cf91258ee53653"><td class="memTemplItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="entry_8cpp.html#aa40eb71eaae48a5fe3cf91258ee53653">guard_stack</a> (T func)</td></tr>
<tr class="separator:aa40eb71eaae48a5fe3cf91258ee53653"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad0723993620b96e10e0c861c1a52dc2b"><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr class="memitem:ad0723993620b96e10e0c861c1a52dc2b"><td class="memTemplItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="entry_8cpp.html#ad0723993620b96e10e0c861c1a52dc2b">guard_exceptions</a> (T func)</td></tr>
<tr class="separator:ad0723993620b96e10e0c861c1a52dc2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1cd017588e4611bface6ed4e38da6c54"><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="entry_8cpp.html#a1cd017588e4611bface6ed4e38da6c54">init_vmm</a> (int64_t arg)</td></tr>
<tr class="separator:a1cd017588e4611bface6ed4e38da6c54"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f5e6f683fb1b2a8076560f026f1b215"><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="entry_8cpp.html#a2f5e6f683fb1b2a8076560f026f1b215">start_vmm</a> (int64_t arg)</td></tr>
<tr class="separator:a2f5e6f683fb1b2a8076560f026f1b215"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af49b886d1221d407231185990125d34a"><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="entry_8cpp.html#af49b886d1221d407231185990125d34a">stop_vmm</a> (int64_t arg)</td></tr>
<tr class="separator:af49b886d1221d407231185990125d34a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa85057298860eeed2dc0257e8863eeb0"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structeh__frame__t.html">eh_frame_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="entry_8cpp.html#aa85057298860eeed2dc0257e8863eeb0">get_eh_frame_list</a> ()</td></tr>
<tr class="separator:aa85057298860eeed2dc0257e8863eeb0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a182a105c02a5f42aae4ec88504baf8d0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="entry_8cpp.html#a182a105c02a5f42aae4ec88504baf8d0">register_eh_frame</a> (void *addr, uint64_t size)</td></tr>
<tr class="separator:a182a105c02a5f42aae4ec88504baf8d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ac379d679b79542036c92e1a171f8a908"><td class="memItemLeft" align="right" valign="top">auto&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="entry_8cpp.html#ac379d679b79542036c92e1a171f8a908">g_eh_frame_list_num</a> = 0ULL</td></tr>
<tr class="separator:ac379d679b79542036c92e1a171f8a908"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8c1acf5e5bba86ad53aff18a39aa043"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structeh__frame__t.html">eh_frame_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="entry_8cpp.html#af8c1acf5e5bba86ad53aff18a39aa043">g_eh_frame_list</a> [<a class="el" href="constants_8h.html#ab5fdce3a6fd51066fb321ec67ef032cf">MAX_NUM_MODULES</a>] = {}</td></tr>
<tr class="separator:af8c1acf5e5bba86ad53aff18a39aa043"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a7db5bff8a5a82a868ae1b3117ede682a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define guard</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">a</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><a class="code" href="entry_8cpp.html#aa40eb71eaae48a5fe3cf91258ee53653">guard_stack</a>([&amp;]() -&gt; int64_t \</div><div class="line">    { <span class="keywordflow">return</span> <a class="code" href="entry_8cpp.html#ad0723993620b96e10e0c861c1a52dc2b">guard_exceptions</a>([&amp;]() { a; }); });</div><div class="ttc" id="entry_8cpp_html_aa40eb71eaae48a5fe3cf91258ee53653"><div class="ttname"><a href="entry_8cpp.html#aa40eb71eaae48a5fe3cf91258ee53653">guard_stack</a></div><div class="ttdeci">int64_t guard_stack(T func)</div><div class="ttdef"><b>Definition:</b> <a href="entry_8cpp_source.html#l00063">entry.cpp:63</a></div></div>
<div class="ttc" id="entry_8cpp_html_ad0723993620b96e10e0c861c1a52dc2b"><div class="ttname"><a href="entry_8cpp.html#ad0723993620b96e10e0c861c1a52dc2b">guard_exceptions</a></div><div class="ttdeci">int64_t guard_exceptions(T func)</div><div class="ttdef"><b>Definition:</b> <a href="entry_8cpp_source.html#l00097">entry.cpp:97</a></div></div>
</div><!-- fragment -->
<p>Definition at line <a class="el" href="entry_8cpp_source.html#l00042">42</a> of file <a class="el" href="entry_8cpp_source.html">entry.cpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="aa40eb71eaae48a5fe3cf91258ee53653"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">int64_t guard_stack </td>
          <td>(</td>
          <td class="paramtype">T&#160;</td>
          <td class="paramname"><em>func</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Guard Stack</p>
<p>Since we are using userspace style code / libraries (like libc++) in this code, we could end up overrunning the stack, as we do not have control of all of the code, and some of it assumes that the stack is very large. This guard provides a new stack that is much larger, ensuring that the kernel's stack is not corrupted.</p>
<p>Note: Order matters here. You must catch all exceptions first before calling this function. Since the execute with stack function uses assembly, there is no FDE entry for this function which means that stack unwinding cannot continue past this point.</p>
<p>Note: We can use make_unqiue here because bad_alloc always results in an abort (i.e. system halt). </p>

<p>Definition at line <a class="el" href="entry_8cpp_source.html#l00063">63</a> of file <a class="el" href="entry_8cpp_source.html">entry.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="ad0723993620b96e10e0c861c1a52dc2b"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">int64_t guard_exceptions </td>
          <td>(</td>
          <td class="paramtype">T&#160;</td>
          <td class="paramname"><em>func</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Guard Exceptions</p>
<p>The following attempts to catch all of the different types of execptions that could be thrown. The default bareflank implementation only throws general exceptions. Libc++ however could also throw a standard exception, which also needs to be caught. We also provide a catch all incase a non-standard exception is thrown, preventing exceptions from moving beyond this point. </p>

<p>Definition at line <a class="el" href="entry_8cpp_source.html#l00097">97</a> of file <a class="el" href="entry_8cpp_source.html">entry.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a1cd017588e4611bface6ed4e38da6c54"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t init_vmm </td>
          <td>(</td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>arg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Init VMM</p>
<p>This function initializes the VMM. The driver entry uses the ELF loader to call this "C" function from the kernel. Prior to executing this function, a new stack is provided, and all exceptions are caught prior to completing. To initialize the VMM, this function calls the <a class="el" href="classvcpu__manager.html">vcpu_manager</a>'s init function, which begins the processing of initialization.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">arg</td><td>unused (likely will contain the cpu's core # in the future) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ENTRY_SUCCESS on success, ENTRY_ERROR_UNKNOWN otherwise. </dd></dl>

<p>Definition at line <a class="el" href="entry_8cpp_source.html#l00134">134</a> of file <a class="el" href="entry_8cpp_source.html">entry.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a2f5e6f683fb1b2a8076560f026f1b215"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t start_vmm </td>
          <td>(</td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>arg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Start VMM</p>
<p>This function starts the VMM. The driver entry uses the ELF loader to call this "C" function from the kernel. Prior to executing this function, a new stack is provided, and all exceptions are caught prior to completing. To start the VMM, this function calls the <a class="el" href="classvcpu__manager.html">vcpu_manager</a>'s start function, which begins the processing of starting the vmm.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">arg</td><td>unused (likely will contain the cpu's core # in the future) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ENTRY_SUCCESS on success, ENTRY_ERROR_UNKNOWN otherwise. </dd></dl>

<p>Definition at line <a class="el" href="entry_8cpp_source.html#l00142">142</a> of file <a class="el" href="entry_8cpp_source.html">entry.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="af49b886d1221d407231185990125d34a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t stop_vmm </td>
          <td>(</td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>arg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Stop VMM</p>
<p>This function stops the VMM. The driver entry uses the ELF loader to call this "C" function from the kernel. Prior to executing this function, a new stack is provided, and all exceptions are caught prior to completing. To stop the VMM, this function calls the <a class="el" href="classvcpu__manager.html">vcpu_manager</a>'s stop function, which begins the processing of stopping the vmm.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">arg</td><td>unused (likely will contain the cpu's core # in the future) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ENTRY_SUCCESS on success, ENTRY_ERROR_UNKNOWN otherwise. </dd></dl>

<p>Definition at line <a class="el" href="entry_8cpp_source.html#l00150">150</a> of file <a class="el" href="entry_8cpp_source.html">entry.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="aa85057298860eeed2dc0257e8863eeb0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structeh__frame__t.html">eh_frame_t</a>* get_eh_frame_list </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get EH Framework List</p>
<p>Returns a list of ".eh_frame" sections, containing their start address, and size. This is used by the unwind library to find stack frames. The list should have one .<a class="el" href="classeh__frame.html">eh_frame</a> section for each module that is loaded.</p>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="classeh__frame.html">eh_frame</a> list (of size MAX_NUM_MODULES) </dd></dl>

<p>Definition at line <a class="el" href="entry_8cpp_source.html#l00162">162</a> of file <a class="el" href="entry_8cpp_source.html">entry.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a182a105c02a5f42aae4ec88504baf8d0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void register_eh_frame </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Register EH Framework</p>
<p>Registers an ".eh_frame" section, containing it's start address, and size. This will add the <a class="el" href="classeh__frame.html">eh_frame</a> section to a global list that can be retreived using get_eh_frame_list</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">addr</td><td>the address of the <a class="el" href="classeh__frame.html">eh_frame</a> section </td></tr>
    <tr><td class="paramname">size</td><td>the size of the <a class="el" href="classeh__frame.html">eh_frame</a> section </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="entry_8cpp_source.html#l00168">168</a> of file <a class="el" href="entry_8cpp_source.html">entry.cpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="ac379d679b79542036c92e1a171f8a908"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">auto g_eh_frame_list_num = 0ULL</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="entry_8cpp_source.html#l00035">35</a> of file <a class="el" href="entry_8cpp_source.html">entry.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="af8c1acf5e5bba86ad53aff18a39aa043"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structeh__frame__t.html">eh_frame_t</a> g_eh_frame_list[<a class="el" href="constants_8h.html#ab5fdce3a6fd51066fb321ec67ef032cf">MAX_NUM_MODULES</a>] = {}</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="entry_8cpp_source.html#l00036">36</a> of file <a class="el" href="entry_8cpp_source.html">entry.cpp</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Apr 27 2016 15:56:28 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.12
</small></address>
</body>
</html>
