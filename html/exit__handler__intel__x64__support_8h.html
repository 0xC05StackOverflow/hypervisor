<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>/home/user/hypervisor/bfvmm/include/exit_handler/exit_handler_intel_x64_support.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_4ad2d4d86f59ad5437031c40d2e6ddb2.html">bfvmm</a></li><li class="navelem"><a class="el" href="dir_3511bcd65bb200fa53abb9c3378e06a8.html">include</a></li><li class="navelem"><a class="el" href="dir_478136c95abae8db5cf3a163d3df7e21.html">exit_handler</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">exit_handler_intel_x64_support.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><a href="exit__handler__intel__x64__support_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aceff3d5f657aa3a7997f06007e1dd8de"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="exit__handler__intel__x64__support_8h.html#aceff3d5f657aa3a7997f06007e1dd8de">exit_handler_entry</a> (void)</td></tr>
<tr class="separator:aceff3d5f657aa3a7997f06007e1dd8de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc7d6cf6e625f445b3b1fd876352d4d6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="exit__handler__intel__x64__support_8h.html#afc7d6cf6e625f445b3b1fd876352d4d6">promote_vmcs_to_root</a> (void)</td></tr>
<tr class="separator:afc7d6cf6e625f445b3b1fd876352d4d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a59a897d45565fc8cdfd76a77a9271275"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="exit__handler__intel__x64__support_8h.html#a59a897d45565fc8cdfd76a77a9271275">g_guest_rax</a></td></tr>
<tr class="separator:a59a897d45565fc8cdfd76a77a9271275"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1be46986ed0a71cee3f9c2be91456572"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="exit__handler__intel__x64__support_8h.html#a1be46986ed0a71cee3f9c2be91456572">g_guest_rbx</a></td></tr>
<tr class="separator:a1be46986ed0a71cee3f9c2be91456572"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab0976e415ae0bc7a37fefbb7dc0a2945"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="exit__handler__intel__x64__support_8h.html#ab0976e415ae0bc7a37fefbb7dc0a2945">g_guest_rcx</a></td></tr>
<tr class="separator:ab0976e415ae0bc7a37fefbb7dc0a2945"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8277eb0df08c9ae8bdede169e7321e1"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="exit__handler__intel__x64__support_8h.html#ad8277eb0df08c9ae8bdede169e7321e1">g_guest_rdx</a></td></tr>
<tr class="separator:ad8277eb0df08c9ae8bdede169e7321e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9dae6dd9776b5a138c7185dbad02dcf8"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="exit__handler__intel__x64__support_8h.html#a9dae6dd9776b5a138c7185dbad02dcf8">g_guest_rbp</a></td></tr>
<tr class="separator:a9dae6dd9776b5a138c7185dbad02dcf8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb230d6100d14b1625cb67cc9946b38b"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="exit__handler__intel__x64__support_8h.html#afb230d6100d14b1625cb67cc9946b38b">g_guest_rsi</a></td></tr>
<tr class="separator:afb230d6100d14b1625cb67cc9946b38b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a978ee0d00f8445677330ab997ce2b276"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="exit__handler__intel__x64__support_8h.html#a978ee0d00f8445677330ab997ce2b276">g_guest_rdi</a></td></tr>
<tr class="separator:a978ee0d00f8445677330ab997ce2b276"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab00b64eb52121f22e3b1cae56adb80fc"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="exit__handler__intel__x64__support_8h.html#ab00b64eb52121f22e3b1cae56adb80fc">g_guest_r08</a></td></tr>
<tr class="separator:ab00b64eb52121f22e3b1cae56adb80fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a874547d245f9da2b7d17be283a7c65d7"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="exit__handler__intel__x64__support_8h.html#a874547d245f9da2b7d17be283a7c65d7">g_guest_r09</a></td></tr>
<tr class="separator:a874547d245f9da2b7d17be283a7c65d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf4019a65c7f928240eb4e46953a61b7"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="exit__handler__intel__x64__support_8h.html#abf4019a65c7f928240eb4e46953a61b7">g_guest_r10</a></td></tr>
<tr class="separator:abf4019a65c7f928240eb4e46953a61b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca463b244e29d3206a9d0453a1e959ee"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="exit__handler__intel__x64__support_8h.html#aca463b244e29d3206a9d0453a1e959ee">g_guest_r11</a></td></tr>
<tr class="separator:aca463b244e29d3206a9d0453a1e959ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0268055e2dce2e078943bc0d48ff3668"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="exit__handler__intel__x64__support_8h.html#a0268055e2dce2e078943bc0d48ff3668">g_guest_r12</a></td></tr>
<tr class="separator:a0268055e2dce2e078943bc0d48ff3668"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a530f4f0a57b97625c21c8249f1b46954"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="exit__handler__intel__x64__support_8h.html#a530f4f0a57b97625c21c8249f1b46954">g_guest_r13</a></td></tr>
<tr class="separator:a530f4f0a57b97625c21c8249f1b46954"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75b1a531b76e21b11fe686aa738e6526"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="exit__handler__intel__x64__support_8h.html#a75b1a531b76e21b11fe686aa738e6526">g_guest_r14</a></td></tr>
<tr class="separator:a75b1a531b76e21b11fe686aa738e6526"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a516de57cd42328845af411460c99a6f4"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="exit__handler__intel__x64__support_8h.html#a516de57cd42328845af411460c99a6f4">g_guest_r15</a></td></tr>
<tr class="separator:a516de57cd42328845af411460c99a6f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af60395134b49207841b2ee398e5b4f4a"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="exit__handler__intel__x64__support_8h.html#af60395134b49207841b2ee398e5b4f4a">g_guest_rsp</a></td></tr>
<tr class="separator:af60395134b49207841b2ee398e5b4f4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4edca8f4f964fee50cde21876923e47f"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="exit__handler__intel__x64__support_8h.html#a4edca8f4f964fee50cde21876923e47f">g_guest_rip</a></td></tr>
<tr class="separator:a4edca8f4f964fee50cde21876923e47f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="aceff3d5f657aa3a7997f06007e1dd8de"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void exit_handler_entry </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Exit Handler Entry</p>
<p>This is the starting point of the VMM. It is written in pure assembly in order to ensure the state of the guest is handled properly. This code saves / restores the guest's CPU state, and then hands control off to the "C" portion of the code to continue execution, and begin the process of handling the VM exit. </p>

</div>
</div>
<a class="anchor" id="afc7d6cf6e625f445b3b1fd876352d4d6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void promote_vmcs_to_root </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Promote Guest VMCS state to VMX root mode</p>
<p>Abandon the host state, and jump into the guest state from the host. </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a59a897d45565fc8cdfd76a77a9271275"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t g_guest_rax</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Guest State</p>
<p>The following exposes the guest state to the rest of the exit handler. Note that this guest state actually exists in the assembly code to provide it easy access to save / restore the guest state on exits. </p>

</div>
</div>
<a class="anchor" id="a1be46986ed0a71cee3f9c2be91456572"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t g_guest_rbx</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ab0976e415ae0bc7a37fefbb7dc0a2945"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t g_guest_rcx</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ad8277eb0df08c9ae8bdede169e7321e1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t g_guest_rdx</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a9dae6dd9776b5a138c7185dbad02dcf8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t g_guest_rbp</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="afb230d6100d14b1625cb67cc9946b38b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t g_guest_rsi</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a978ee0d00f8445677330ab997ce2b276"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t g_guest_rdi</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ab00b64eb52121f22e3b1cae56adb80fc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t g_guest_r08</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a874547d245f9da2b7d17be283a7c65d7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t g_guest_r09</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="abf4019a65c7f928240eb4e46953a61b7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t g_guest_r10</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="aca463b244e29d3206a9d0453a1e959ee"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t g_guest_r11</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a0268055e2dce2e078943bc0d48ff3668"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t g_guest_r12</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a530f4f0a57b97625c21c8249f1b46954"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t g_guest_r13</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a75b1a531b76e21b11fe686aa738e6526"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t g_guest_r14</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a516de57cd42328845af411460c99a6f4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t g_guest_r15</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="af60395134b49207841b2ee398e5b4f4a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t g_guest_rsp</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a4edca8f4f964fee50cde21876923e47f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t g_guest_rip</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Apr 27 2016 15:56:28 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.12
</small></address>
</body>
</html>
